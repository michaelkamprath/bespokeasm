description: Eater SAP-1 Enhanced ISA
general:
  min_version: 0.7.0
  address_size: 4
  identifier:
    name: eater-sap1-enahanced
    version: "1.0.0"
    extension: sap1e
  registers:
    a:
      title: Accumulator register
    b:
      title: Temp register
    pc:
      title: Program Counter
    out:
      title: Output register
  flags:
    CF:
      name: carry
      description: The carry flag generated from addtion and subtraction
    ZF:
      name: zero
      description: The zero flag generated by the contents of the `A` register.
  documentation:
    description: Ben Eater SAP-1
    examples:
      - title: Multiply two memory operands and show the product
        description: Uses repeated addition so the multiplier value stored at `$0F` decrements to zero while the partial sum in `$0C` accumulates the product; set addresses `$0E`/`$0F` before running, then reset `factor_b` to change operands.
        code: |-
          ; Multiply the bytes stored at addresses $0E and $0F, emit the product on the OUT register
          #require __LANGUAGE_NAME__ == eater-sap1
          #require __LANGUAGE_VERSION__ >= 1.0.0
          .org $0

          check_multiplier:
              LDA factor_b
              JZ output_result
              LDA partial

          multiply_loop:
              ADD factor_a
              STA partial
              LDA factor_b
              SUB decrement
              STA factor_b
              JMP check_multiplier

          output_result:
              LDA partial
              OUT
              HLT

          .org $0C

          partial:
              .byte $00

          decrement:
              .byte $01

          factor_a:
              .byte $04

          factor_b:
              .byte $03
operand_sets:
  integer:
    operand_values:
      int8:
        type: numeric
        argument:
          size: 4
          word_align: false
    documentation:
      title: Integer Value Operands
      description: Immediate integer value that fits in the lower 4-bits after the instruction.
  address:
    operand_values:
      addr:
        type: numeric
        argument:
          size: 4
          word_align: false
    documentation:
      title: Memory Address Operands
      description: Memory address location value that fits in the lower 4-bits after the instruction.
instructions:
  nop:
    bytecode:
      value: 0
      size: 4
    documentation:
      category: operations
      title: no opperation
      description: Makes no changes to any register of memory address. However, `pc` does incrmeent and clock cycles are epxended.
  lda:
    bytecode:
      value: 1
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - address
    documentation:
      category: data movement
      title: Load A
      description: Load register `a` with value at address provided as an operand
      modifies:
      - register: a
  add:
    bytecode:
      value: 2
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - address
    documentation:
      category: arithmetic
      title: Add to `A`
      description: Adds the value at provided address to the contents in `a` register
      modifies:
      - register: "`a`"
        description: will contain the results of the addition
      - flag: carry
        description: Set to the value of the 8-bit addition carry bit.
      - flag: zero
        description: Set to 1 if the results are equal to zero, 0 otherwise.
  sub:
    bytecode:
      value: 3
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - address
    documentation:
      category: arithmetic
      title: Subtract from `A`
      description: Subtracts the value at provided address from the contents in `a` register
      modifies:
      - register: "`a`"
        description: will contain the results of the subtraction
      - flag: carry
        description: Set to the value of the 8-bit subtraction carry bit.
      - flag: zero
        description: Set to 1 if the results are equal to zero, 0 otherwise.
  sta:
    bytecode:
      value: 4
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - address
    documentation:
      category: data movement
      title: Store `A`
      description: Writes value in register `a` to memory at the address provided as an operand
      modifies:
      - memory: address in operand value
        description: Will contain the value originally in `a` register
  ldi:
    bytecode:
      value: 5
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - integer
    documentation:
      category: data movement
      title: Load Immediate
      description: load register `a` with the 4-bit immediate value provided in the operand
      modifies:
      - register: "`a`"
        description: Will be set to the value of the immediate operand
  jmp:
    bytecode:
      value: 6
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - address
    documentation:
      category: control
      title: Jump
      description: Set program counter to address provided in operand, making the next instruction to be executed from that address.
      modifies:
      - register: "`pc`"
        description: Will contrain memory address passed in operand
  jc:
    bytecode:
      value: 7
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - address
    documentation:
      category: control
      title: Jump if Carry Set
      description: Set program counter to address provided in operand if carry flag is set
      modifies:
      - register: "`pc`"
        description: Will contrain memory address passed in operand if condition is true
  jz:
    bytecode:
      value: 8
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - address
    documentation:
      category: control
      title: Jump if Zero Set
      description: Set program counter to address provided in operand if zero flag is set
      modifies:
      - register: "`pc`"
        description: Will contrain memory address passed in operand if condition is true
  adi:
    bytecode:
      value: 9
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - integer
    documentation:
      category: arithmetic
      title: Add Immediate
      description: Adds immediate value to register `a`
      modifies:
      - register: "`a`"
      - flag: carry
        description: Set to the value of the 8-bit addition carry bit.
      - flag: zero
        description: Set to 1 if the results are equal to zero, 0 otherwise.
  sui:
    bytecode:
      value: 10
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - integer
    documentation:
      category: arithmetic
      title: Subtract Immediate
      description: Subtracts immediate value from register `a`
      modifies:
      - register: "`a`"
      - flag: carry
        description: Set to the value of the 8-bit subtraction carry bit.
      - flag: zero
        description: Set to 1 if the results are equal to zero, 0 otherwise.
  shl:
    bytecode:
      value: 11
      size: 4
    documentation:
      category: arithmetic
      title: Shift Left
      description: Shifts the value in the `a` register left by 1 bit.
      modifies:
      - register: "`a`"
  cpi:
    bytecode:
      value: 12
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - integer
    documentation:
      category: control
      title: Compare Immediate
      description: Compares immediate value to value in register `a`
      modifies:
      - flag: carry
        description: If set, then the `a` register value is greater than or equal to the immediate value.
      - flag: zero
        description: If set, then the `a` register value is equal to the immediate value.
  mot:
    bytecode:
      value: 13
      size: 4
    operands:
      count: 1
      operand_sets:
        list:
          - address
    documentation:
      category: input/output
      title: Disaply Value at Memory Address
      description: Copies value at memory address to `out` register, displaying it on the 7 segment LED display as decimal
      modifies:
      - register: "`out`"
  out:
    bytecode:
      value: 14
      size: 4
    documentation:
      category: input/output
      title: Display Value
      description: Copies value in register `a` to `out` register, displaying it on the 7 segment LED display as decimal
      modifies:
      - register: "`out`"
  hlt:
    bytecode:
      value: 15
      size: 4
    documentation:
      category: control
      title: Halt Clock
      description: Halt the computer clock, stopping all execution.
